{% load oifilters %}
{% load i18n %}
<div id="prjdialogue_{{project.id}}" class="popup invisible"></div>
<div class="prjinfo">
    <div>
        {% if project.assignee %}
            <img class="contactpicture" src="/user/getpicture/{{project.assignee.username}}">{% trans "Offer" %}: {{project.offer}} €
            {% if project.assignee == user and project.state < 2 %}<img class="clickable" src="/img/icons/edit.png" onclick="offerProject({{project.id}})" />{% endif %}
        {% else %}
            {% trans "No one is in charge of this project" %}
            <img class="clickable" src="/img/icons/assignprj.png" onclick="offerProject({{project.id}})" title="{% trans "Make an offer" %}" alt="{% trans "Take on this project" %}" />
        {% endif %}
    </div>
    <div class="cleared"></div>
    <div id="bids_{{project.id}}">
        <h3>{% trans "Bids:" %} {{project.bid_sum}} €</h3>
        {% for bid in project.bid_set.all %}
        <div>
        {{bid.user}} : {{bid.amount}} €
        {% ifequal user bid.user %}
        {% if project.state < 2 %}<img class="clickable" src="/img/icons/add.png" onclick="bidProject({{project.id}})" />{% endif %}
        <img class="clickable" src="/img/icons/delete.png" onclick="cancelBid({{project.id}}, {% if project.state > 1 %}true{% else %}false{% endif %})" alt="{% trans "Cancel your bid on this project" %}" title="{% trans "Cancel your bid on this project" %}" />
        {% endifequal %}
        </div>
        {% endfor %}
        <div>
            <h3>{% if project.missing_bid > 0 %}{% trans "missing" %} {{project.missing_bid|floatformat:2}} €{% endif %}</h3>
            {% if project.state < 3 %}{% if project|can_read:user %}{% if not project|is_bidder:user %}
            <div onclick="bidProject({{project.id}})" class="clickable slidermore">{% trans "Bid_verb" %}</div>
            {% endif %}{% endif %}{% endif %}
        </div>
    </div>
    {% ifequal user project.assignee %}
    {% for bid in project.canceled_bids %}
    <div id="question_{{project.id}}_{{bid.id}}" class="smalltext">
        {{bid.user.username}} {% trans "wants to cancel his" %} <br /> {% trans "bid on this project" %}<br />
        {% trans "Your offer will be reduced of" %} {{bid.amount}}.<br />
        {% trans "Do you accept it?" %}
        <img class="clickable" src="/img/icons/ok.png" onclick="answerCancelBid({{project.id}}, {{bid.id}}, true, 'question_{{project.id}}_{{bid.id}}')" title="{% trans "Accept" %}" alt="{% trans "Accept" %}"/>
        <img class="clickable" src="/img/icons/delete.png" onclick="answerCancelBid({{project.id}}, {{bid.id}}, false, 'question_{{project.id}}_{{bid.id}}')" title="{%trans "Refuse" %}" alt="{%trans "Refuse" %}"/>
    </div>
    {% endfor %}
    {% endifequal %}
    {% if project|is_bidder:user %}
    {% ifequal project.state 11 %}
    <div id="question_{{project.id}}_{{bid.id}}" class="smalltext">
        {{project.assignee.username}} {% trans "wants to cancel this project." %}<br />
        {% trans "You will be reimbursed in full." %}<br />
        {% trans "Do you accept it?" %}
        <img class="clickable" src="/img/icons/ok.png" onclick="answerCancelProject({{project.id}}, true, 'question_{{project.id}}')" title="{% trans "Accept" %}" alt="{% trans "Accept" %}"/>
        <img class="clickable" src="/img/icons/delete.png" onclick="answerCancelProject({{project.id}}, false, 'question_{{project.id}}')" title="{%trans "Refuse" %}" alt="{%trans "Refuse" %}"/>
    </div>
    {% endifequal %}
    {% if project.delay %}
    <div id="question_{{project.id}}_{{bid.id}}" class="smalltext">
        {{project.assignee.username}} {% trans "wants to change this project due date to" %} {{project.delay|date:"d/m/Y"}}<br />
        {% trans "Do you accept it?" %}
        <img class="clickable" src="/img/icons/ok.png" onclick="answerDelayProject({{project.id}}, true, 'question_delay_{{project.id}}')" title="{% trans "Accept" %}" alt="{% trans "Accept" %}"/>
        <img class="clickable" src="/img/icons/delete.png" onclick="answerDelayProject({{project.id}}, false, 'question_delay_{{project.id}}')" title="{%trans "Refuse" %}" alt="{%trans "Refuse" %}"/>
    </div>
    {% endif %}
    {% endif %}
</div>
<div id="budget" class="prjtable"></div>
<script>
    oiTable = new OITable("budget", ["{% trans 'Budget' %}","{% trans 'Engaged' %}","{% trans 'Bid_verb' %}"]);
    oiTable.addLine({{project.master.id}}, ["{{project.master.alloffer_sum}} €", "{{project.master.allbid_sum}} €", "<input type='checkbox' class='tablecheckbox'/>"])
</script>
