{% extends "base.html" %}
﻿﻿{% load oifilters %}
{% load i18n %}
{% block title %}{{object.title|default:_("Project")}}{% endblock %}
{% block pagetitle %}{{object.title|default:_("Project")}}{% endblock %}
{% block indicators %}
<div class="prj-private-bloc">
    <div id="public_{{object.id}}" {% if not object.public %} class="invisible" {% endif %}> {% trans "Public task" %} </div>  <div id="nopublic_{{object.id}}" {% if object.public %} class="invisible" {% endif %}> {% trans "Private task" %} </div>
    <a class="clickable" onclick="toggleHideProject({{object.id}}); $('#public_{{object.id}}').toggle(); $('#nopublic_{{object.id}}').toggle(); $('#public_{{object.id}}_1').toggle(); $('#nopublic_{{object.id}}_2').toggle()"> 
        <div id="public_{{object.id}}_1" {% if not object.public %} class="invisible" {% endif %}> {% trans "Make this task public" %} <img src="/img/icons/bluebtn.png"/></div>
        <div id="nopublic_{{object.id}}_2" {% if object.public %} class="invisible" {% endif %}> {% trans "Make this task private" %} <img src="/img/icons/bluebtn.png"/></div>
    </a>
</div>
<div class="prj-block-fav">
    <div class="prj-star-fav">
        <img id="fav_{{object.id}}" class="clickable" title="{% trans 'follow the project' %}" alt="{% trans 'follow the project' %}" src="/img/icons/star{{object|is_following:user}}.png" onclick="favProject({{object.id}})">
    </div>
    <div>{{object.observer_set.count}} {% blocktrans count counter=object.observer_set.count %} subscriber {% plural %} subscribers {% endblocktrans %}</div>
</div>
{% for task in object.ancestors|filter_read:user %}<a href="/project/{{task.id}}/view/overview">{{task.title}}</a> &gt; {% endfor %}
{% endblock %}
{% block actions %}{% include "projects/project_actions.html" %}{% endblock %}
{% block nav %}
<div id="projecttree"></div> <div id="loading"> </div> 
{% if object.master.descendants.count < 1 %}<div class="tasktip"><img src="/img/askoi.png" />{% trans "Tasks in the project are to be listed here" %}</div>{% endif %}
{% endblock %}
{% block content %}
<div class="pagetop">
    <div id="tabs">
    {% for view in views %}
        <div class="{% ifequal current_view view %}selectedtab {% endifequal %}tab">
            <a href="/project/{{object.id}}/view/{{view}}"><img class="tabicon" src="/img/icons/{{view}}{% ifequal current_view view %}white{% endifequal %}.png"/> {% trans view %}</a>
        </div>
    {% endfor %}
    </div>
    <div id="tools">
        {% include 'projects/project_state.html' %}
    </div>
</div>
{% if object|can_read:user %}
{% with object as project %}
<div id="project_{{project.id}}" class="project">
    <div id="prjdialogue_{{project.id}}" class="popup invisible"></div>
    <div class="prjbody">
    {% with "projects/project_"|add:current_view|add:".html" as template_name %}
    {% include template_name %}
    {% endwith %}
        <div class="cleared"></div> 
    </div>
</div>
{% endwith %}
<script>
    function initOITree() {
        if (document.getElementById("add_new_release").selected){ 
            addRelease({{object.id}});
            document.getElementById("add_new_release").selected = false;
        };
        oiTree.init();
        if(oiTable) {
            oiTable.init();
            oiTable.addLine({{object.master.id}}, firstLine);
        }
        var rootdiv = oiTree.setRoot({{object.master.id}}, {{object.master.state}}, 0);
        setTaskName(rootdiv, {{object.master.id}}, "{{object.master.title}}", "{{current_view}}");
        rootdiv.className += " treeroot";
        OIajaxCall("/project/{{object.id}}/listtasks?release="+getValue("release")+"&expand={% for ancestor in object.get_path %}{{ancestor.id}},{% endfor %}", null, "loading",  
            function(response){
                populateTaskList(eval('('+response+')'));
                {% for ancestor in object.get_path %}
                if(oiTree.nodes[{{ancestor.id}}]) oiTree.nodes[{{ancestor.id}}].expand();
                {% endfor %}
                if(oiTree.nodes[{{object.id}}]) setActiveTask({{object.id}}{% if object.state < 4 and object|can_write:user %}, true{% endif %});
                clearDiv("loading");
            }
        );
    }
    coloration = {{object.state}};
    follow = {% if object|is_following:user %}true{%else%}false{%endif%};
    username = '{{user.username}}';
    viewname = '{{current_view}}';
    oiTree = new OITree("projecttree");
    initOITree();
</script>
{% else %}
{% trans "Forbidden" %}
{% endif %}
{% endblock %}
