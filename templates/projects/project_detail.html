{% extends "base.html" %}
﻿﻿{% load oifilters %}
{% block content %}
{% if object|can_read:user %}
{% with object as project %}
<div class="list">
    <div id="project_{{project.id}}" class="project">
        <div class="prjtop"></div>
        <div class="prjbody">
            <div class="actions">
                {% if project|can_read:user %}<a href="{% url oi.projects.views.projectview id=project.id%}">
                    <img src="/img/icons/viewprj.png" alt="Vue d'ensemble" title="Vue d'ensemble" />
                </a>{% endif %}
                {% if project|can_write:user %} <img onclick="finishProject({{project.id}})" src="/img/icons/okprj.png" alt="Marquer le projet comme terminé" title="Marquer le projet comme terminé" />
                <a href="{% url oi.projects.views.deleteproject id=project.id%}">
                    <img src="/img/icons/delprj.png" alt="Supprimer le projet" title="Supprimer le projet" />
                </a>
                <a href="{% url oi.projects.views.editproject id=project.id%}">
                    <img src="/img/icons/project.png" alt="Modifier le projet" title="Modifier le projet" />
                </a>{% endif %}
            </div>
            <div class="prjtitle">
                {{project.title}}
            </div>
            assigné à : {{project.assignee}}<br />
            démarré le : {{project.start_date|date:"d/m/Y"}}<br />
            du le : {{project.due_date|date:"d/m/Y"}}<br />
            Avancement : {{project.progress|multiply:100}}%<br />
            <div id="specs_{{project.id}}">
                {%for spec in project.get_specs%}
                <div id="specs_{{project.id}}_{{spec.order}}">
                    {%include 'projects/spec.html'%}
                </div>
                {%endfor%}
            </div>
            {% if project|can_write:user %}<img src="/img/icons/addspec.png" onclick="addSpec({{project.id}}, -1)" alt="Ajouter une spécification" title="Ajouter une spécification"/>{% endif %}
            <br />
            Publié par {% if project.author %}
            <a href="/user/profile/{{project.author.username}}">{{project.author}}</a>
            {% else %}
            invité
            {% endif %} le {{project.created}}
        </div>
        <div class="prjbtm"></div>
    </div>
</div>
<div id="tasks_{{project.id}}" class="list">
    Tâches :
    {% if project|can_write:user %}
    <div>
        <input type="text" id="newtask_title_{{project.id}}"/>
        <img src="/img/icons/addprj.png" alt="Nouvelle tâche" title="Nouvelle tâche" onclick="addTask({{project.id}},'{{user.username}}')" />
    </div>
    {% endif %}
    {%if project.tasks.all%}
    {%for task in project.tasks.all%}
    {% if task|can_read:user %}
    {% include "projects/task.html" %}<br />
    {% endif %}
    {%endfor%}
    {%endif%}
</div>
{% endwith %}
{% else %}
Permissions insuffisantes
{% endif %}
{% endblock %}
