{% extends "base.html" %}
﻿﻿{% load oifilters %}
{% block title %}{{object.title|default:"Projet"}}{% endblock %}
{% block breadcrumb %}
{% for ancestor in object.get_path %}
<a href="/project/get/{{ancestor.id}}">{{ancestor.title}}</a>{% if not forloop.last %} - {% endif %}
{% endfor %}
{% endblock %}
{% block content %}
{% if object|can_read:user %}
{% with object as project %}
<div class="column">
    <div id="project_{{project.id}}" class="project">
        <div class="prjtop"></div>
        <div class="prjbody">{% include "projects/project_actions.html" %}{% include "projects/project_state.html" %}
            <div class="prjtitle">
                {{project.title}} {% if project|can_write:user %}<img class="clickable" src="/img/icons/edit.png" />{% endif %}
            </div>
            <div id="prjdialogue_{{project.id}}" class="popup invisible"></div>
            <div>
                démarré le : <span id="start_date_{{project.id}}">{{project.start_date|date:"d/m/Y"}}</span>
                {% if project|can_write:user %}{% with "start_date" as field_name %}
                {% include "projects/edit_date.html" %}
                {% endwith %}{% endif %}
            </div>
            <div>
                du le : <span id="due_date_{{project.id}}">{{project.due_date|date:"d/m/Y"}}</span>
                {% if project|can_write:user %}{% with "due_date" as field_name %}
                {% include "projects/edit_date.html" %}
                {% endwith %}{% endif %}
            </div>
            <h3>Spécifications</h3>
            <div id="specs_{{project.id}}">
                {%for spec in project.get_specs%}
                <div id="specs_{{project.id}}_{{spec.order}}">
                    {%include 'projects/spec/spec.html'%}
                </div>
                {%endfor%}
            </div>
            {% if project|can_write:user %}<img class="clickable" src="/img/icons/addspec.png" onclick="addSpec({{project.id}}, -1)" alt="Ajouter une spécification" title="Ajouter une spécification"/>{% endif %}
            <br />
            Projet proposé par {% if project.author %}
            <a href="/user/profile/{{project.author.username}}">{{project.author}}</a>
            {% else %}
            invité
            {% endif %} le {{project.created}}
        </div>
        <div class="prjbtm"></div>
    </div>
</div>
<div id="tasks_{{project.id}}" class="column">
    Tâches :
    {% if project|can_write:user %}
    <div>
        <input type="text" id="newtask_title_{{project.id}}"/>
        <img class="clickable" src="/img/icons/addprj.png" alt="Nouvelle tâche" title="Nouvelle tâche" onclick="addTask({{project.id}},'{{project.assignee.username}}')" />
    </div>
    {% endif %}
    {%if project.tasks.all%}
    {%for task in project.tasks.all%}
    {% if task|can_read:user %}
    {% include "projects/task.html" %}<br />
    {% endif %}
    {%endfor%}
    {%endif%}
</div>
{% endwith %}
{% else %}
Permissions insuffisantes
{% endif %}
{% endblock %}
