{% load i18n %}
{% load oifilters %}
<div style="position:relative" id="spec_{{project.id}}_{{spec.order}}" class="cleared">
    {% if spec.type == 5 %}
    <a href="{{spec.file.url}}"><img src="/img/icons/dlspec.png" alt="Download the specification" title="Download the specification"/></a>
    {% endif %}
    <div id="spec_{{project.id}}_{{spec.order}}_content"{% if project|can_write:user and project.state < 2 %} class="clickable" onclick="(new OISpot(this, {{project.id}}, {{spec.id}}, 0, (event.pageX||(event.clientX + document.documentElement.scrollLeft))-this.parentNode.offsetLeft, (event.pageY||(event.clientY + document.documentElement.scrollTop))-this.parentNode.offsetTop)).edit();event.stopPropagation();"{% endif %}>
        <input type="hidden" id="specid_{{spec.order}}" value="{{spec.id}}" />
        {% if spec.type == 2 %}<img style="max-width:700px" src="{% if spec.file %}{{spec.file.url}}{% endif %}" />{% endif %}
        {% if spec.type == 3 or spec.type == 4 %}
        <a href="{{spec.url}}" >{{spec.text|oiunescape|default:spec.url}}</a>
        {% else %}{{spec.text|oiunescape}}{% endif %}
    </div>
    <div class="specfooter">
        {% if spec.author %}
        <a href="/user/profile/{{spec.author.username}}" class="specauthor">{{spec.author.get_profile}}</a>
        {% else %}
        {% trans "Guest" %}
        {% endif %} {{spec.created|date:"d/m/Y H:i:s"}}
        <div class="sepspecfooter"></div>
        {% if project|can_write:user and project.state < 2 %}
        <img class="clickable" src="/img/icons/delete.png" onclick="deleteSpec({{project.id}}, {{spec.order}})" alt="Delete the specification" title="Delete the specification"/>
        <img class="clickable" src="/img/icons/edit.png" onclick="editSpec({{project.id}}, {{spec.order}})" alt="Correct the specification" title="Correct the specification"/>
        <img class="clickable" src="/img/icons/add.png" onclick="addSpec({{project.id}}, {{spec.order}})" alt="Add a specification" title="Add a specification"/>
        {% endif %}
    </div>
    <div class="sepspec"></div>
    <div class="invisible" id="newspot">{% include 'projects/spec/edit_spot.html' %}</div>
</div>
<script>
{% for spot in spec.spot_set.all %}
    new OISpot(document.getElementById("spec_{{project.id}}_{{spec.order}}"), {{project.id}}, {{spec.id}}, {{spot.id}}, {{spot.offsetX}}, {{spot.offsetY}}, '{{spot.task.title}}', {{spot.task.id}}, {{spot.number}});
{% endfor %}
{% if project|can_write:user and project.state < 2 %}
    document.getElementById("spec_{{project.id}}_{{spec.order}}_content").receiveNode = function receiveNode(id, event) {
        var spot = new OISpot(document.getElementById("spec_{{project.id}}_{{spec.order}}"), {{project.id}}, {{spec.id}}, 0, (event.pageX|(event.clientX + document.documentElement.scrollLeft))-this.parentElement.offsetLeft, (event.pageY|(event.clientY + document.documentElement.scrollTop))-this.parentElement.offsetTop);
        spot.save(id);
    }
{% endif %}
</script>
