{% extends "funding/base.html" %}
{% load i18n %}
{% load oifilters %}
{% block title %}{{selected_user.username}}{% endblock %}
{% block content %}
<div class="prjbody prjbodyprofile">
    <div class="column profile_column user_picture_bio">
        <img id="user_picture" class="profilepicture" src="/user/getpicture/{{selected_user.username}}" />
        {% ifequal user selected_user %}
        <img class="clickable" src="/img/icons/edit.png" onclick="$('#profile_picture').toggle()" />
        <div id="profile_picture" class="cleared filebox invisible">
            <form id="profile_picture_form" method="post" enctype="multipart/form-data" action="/user/uploadpicture" target="picturedest">
                {% csrf_token %}
                <input id="picture" name="picture" type="file" size="1" onchange="document.getElementById('profile_picture_form').submit();hide('profile_picture')" class="filepicker" />
            </form>
        </div>
        <iframe id="picturedest" name="picturedest" class="filedest"></iframe>
        {% endifequal %}
        <div class="profile_info cleared">
            <img src="/img/logo_small.png" class="column">
            <div>{{selected_user.get_profile.get_created_projects.count}} {% trans "Projects created" %}</div>
            <div>{{selected_user.get_profile.get_funded_projects.count}} {% trans "Projects funded" %}</div>
            {% ifnotequal user selected_user %}
            <a class="clickable" onclick="writeMP('{{selected_user.username}}')">{% trans "Contact me!" %}</a>
            {% endifnotequal %}
        </div>
    </div>
    <div class="profilecolumn project">
        <h1>
            {{selected_user.get_profile}}
            {% ifequal user selected_user %}<a href="/user/myaccount"><img src="/img/icons/edit.png" /></a>{% endifequal %}
        </h1>
        <div><a target="_blank" href="{{selected_user.get_profile.personal_website}}">{% if selected_user.get_profile.personal_website %}{{selected_user.get_profile.personal_website}}{% endif %}</a></div>
        <div>{{selected_user.get_profile.city}}, {{selected_user.get_profile.country}}</div>
        
        <h2>
            {% trans "My bio" %}
            {% ifequal user selected_user %}<img src="/img/icons/edit.png" onclick="editBio()" class="clickable"/>{% endifequal %}
            </h2>
        <div id="bio">{% autoescape off %}{{selected_user.get_profile.bio|oiunescape}}{% endautoescape %}</div>
        <div id="bio_edit" class="invisible">
            <div class="actions">
                <img class="clickable" src="/img/icons/ok-32.png" onclick="saveBio()"/>
                <img class="clickable" src="/img/icons/delete.png" onclick="cancelBio()"/>
            </div>
            <div class="cleared">
            {% with textvalue=selected_user.get_profile.bio id='bio' %}
                {% include 'messages/uploadImageTextarea.html' %}
            {% endwith %}
            </div>
        </div>
    </div>
</div>
<div class="related">
    {% if selected_user.get_profile.get_created_projects|filter_read:user %}<div class="tasktitle form_center">{% trans "Projects created" %}</div>{% endif %}
    <div id="created_visible">
        <ul class="home_ul_center">
        {% for project in selected_user.get_profile.get_created_projects|filter_read:user|slice:":3" %}
            <li>
                {% include 'funding/project_card.html' %}
            </li>
        {% endfor %}
        </ul>
    </div>
    
    <div id="created_invisible" class="invisible">
        <ul class="home_ul_center">
        {% for project in selected_user.get_profile.get_created_projects|filter_read:user %}
            <li>
                {% include 'funding/project_card.html' %}
            </li>
        {% endfor %}
        </ul>
    </div>
    <div class="cleared"></div>
    {% with tasks=selected_user.get_profile.get_funded_projects|filter_read:user %}
    {% if tasks.count > 3 %}<span class="clickable" onclick="seeMore('created_visible', 'created_invisible')"><a class="btn_feature fundingright bluesky">{% trans "See more" %}</a></span>
    {% endif %}
    {% endwith %}
    
    <div class="cleared"></div>
    {% if selected_user.get_profile.get_funded_projects|filter_read:user %}<div class="tasktitle form_center">{% trans "Projects funded" %}</div>{% endif %}
    <div id="funded_visible">
        <ul class="home_ul_center">
        {% for project in selected_user.get_profile.get_funded_projects|filter_read:user|slice:":3" %}
            <li>
                {% include 'funding/project_card.html' %}
            </li>
        {% endfor %}
        </ul>
    </div>
    <div id="funded_invisible" class="invisible">
        <ul class="home_ul_center">
        {% for project in selected_user.get_profile.get_funded_projects|filter_read:user %}
            <li>
                {% include 'funding/project_card.html' %}
            </li>
        {% endfor %}
        </ul>
    </div>
    <div class="cleared"></div>
    {% with tasks=selected_user.get_profile.get_funded_projects|filter_read:user %}
    {% if tasks.count > 3 %}<span class="clickable" onclick="seeMore('funded_visible', 'funded_invisible')"><a class="btn_feature fundingright bluesky">{% trans "See more" %}</a></span>
    {% endif %}
    {% endwith %}
</div>
<div id="sendmp" class="popupmsg invisible"></div>
{% endblock %}
