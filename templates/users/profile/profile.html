{% extends "funding/base.html" %}
{% load i18n %}
{% load oifilters %}
{% block title %}{{selected_user.username}}{% endblock %}
{% block content %}
<div class="prjbody">
    <div class="column profile_column">
        <img id="user_picture" class="profilepicture" src="/user/getpicture/{{selected_user.username}}" />
        {% ifequal user selected_user %}
        <img class="clickable" src="/img/icons/edit.png" onclick="$('#profile_picture').toggle()" />
        <div id="profile_picture" class="cleared filebox invisible">
            <form id="profile_picture_form" method="post" enctype="multipart/form-data" action="/user/uploadpicture" target="picturedest">
                {% csrf_token %}
                <input id="picture" name="picture" type="file" size="1" onchange="document.getElementById('profile_picture_form').submit();hide('profile_picture')" class="filepicker" />
            </form>
        </div>
        <iframe id="picturedest" name="picturedest" class="filedest"></iframe>
        {% endifequal %}
        <div class="profile_info cleared">
            <img src="/img/logosmall.png" class="column">
            <div>{{selected_user.get_profile.get_created_projects.count}} {% trans "Projects created" %}</div>
            <div>{{selected_user.get_profile.get_funded_projects.count}} {% trans "Projects funded" %}</div>
            {% ifnotequal user selected_user %}
            <a class="clickable" onclick="writeMP('{{selected_user.username}}')">{% trans "Contact me!" %}</a>
            {% endifnotequal %}
        </div>
    </div>
    <div class="profilecolumn">
        <h1>
            {{selected_user.get_profile}}
            {% ifequal user selected_user %}<a href="/user/myaccount"><img src="/img/icons/edit.png" /></a>{% endifequal %}
        </h1>
        <div><a target="_blank" href="{{selected_user.get_profile.personal_website}}">{% if selected_user.get_profile.personal_website %}{{selected_user.get_profile.personal_website}}{% endif %}</a></div>
        <div>{{selected_user.get_profile.city}}, {{selected_user.get_profile.country}}</div>
        
        <h2>
            {% trans "My bio" %}
            {% ifequal user selected_user %}<img src="/img/icons/edit.png" onclick="editBio()" class="clickable"/>{% endifequal %}
            </h2>
        <div id="bio">{% autoescape off %}{{selected_user.get_profile.bio|oiunescape}}{% endautoescape %}</div>
        <div id="bio_edit" class="invisible">
            <div class="actions">
                <img class="clickable" src="/img/icons/ok-32.png" onclick="saveBio()"/>
                <img class="clickable" src="/img/icons/delete.png" onclick="cancelBio()"/>
            </div>
            <div class="cleared">
            {% with textvalue=selected_user.get_profile.bio id='bio' %}
                {% include 'messages/uploadImageTextarea.html' %}
            {% endwith %}
            </div>
        </div>
    </div>
</div>
<div class="related">
    {% if selected_user.get_profile.get_created_projects|filter_read:user %}<div class="tasktitle">{% trans "Projects created" %}</div>{% endif %}
    {% for project in selected_user.get_profile.get_created_projects|filter_read:user %}
        {% include 'funding/project_card.html' %}
    {% endfor %}
    {% if selected_user.get_profile.get_funded_projects|filter_read:user %}<div class="tasktitle">{% trans "Projects funded" %}</div>{% endif %}
    {% for project in selected_user.get_profile.get_funded_projects|filter_read:user %}
        {% include 'funding/project_card.html' %}
    {% endfor %}
</div>
<div id="sendmp" class="popupmsg invisible"></div>
{% endblock %}
