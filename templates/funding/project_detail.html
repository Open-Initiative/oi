{% extends "funding/base.html" %}
﻿﻿{% load oifilters %}
{% load i18n %}
{% block title %}{{object.title|default:_("Project")}}{% endblock %}
{% block breadcrumb %}
<div class="path-element">{{object.title}}</div>
{% endblock %}
{% block content %}
{% if object|can_read:user %}

<div style="float: left;width: 730px;">

    <div class="prjbody">
        {% with object as project %}
        <div id="project_{{object.id}}" class="project">
            <div id="prjdialogue_{{object.id}}" class="popup invisible"></div>
            <div class="prjheader">
                <div class="prjauthor">{% trans "Project created by" %} <a href="/user/profile/{{object.author.username}}">{{object.author.get_profile}}</a></div>
                <div>
                    <div class="tasktitle" id="prjtitle_{{object.id}}" title="{{object.title}}">
                        {{object.title}}
                    </div>
                    <div class="prj-block-fav">
                        <img onclick="favProject(174)" src="/img/icons/starTrueFunding.png" alt="{% trans 'follow the project' %}" title="{% trans 'follow the project' %}" class="clickable followicon" id="fav_174" />
                        {{object.observer_set.count}} {% blocktrans count counter=object.observer_set.count %} subscriber {% plural %} subscribers {% endblocktrans %}
                    </div>
                </div>
                <div class="cleared"></div>
                {% if object|can_write:user %}
                    <a href="edit"><div style="float: left;" class="bidaction">{% trans "Edit your project" %}</div></a>
                    <a href="manage"><div class="bidaction">{% trans "Manage your features" %}</div></a>
                {% endif %}
            </div>
            <div id="specs_{{project.id}}" class="prjdesc">
            
                {%for spec in project.all_specs_with_languages|dictsort:"order"%}
                    <div style="position:relative" id="spec_{{project.id}}_{{spec.order}}" class="cleared funding_space">
                        {% with project as object %}{%include 'funding/spec/spec.html'%}{% endwith %}
                    </div>
                {% endfor %}
                
            </div>
            
            
        </div>
        <div class="cleared"></div>
        {% endwith %}
    </div>
    
{% with object as project %}
    <div class="cleared"></div>
    <div>
        <div id="discussions_{{project.id}}" class="discussions">
            {% for message in project.message_set.all %}
            <div id="message_{{message.id}}_box">{% include 'messages/message.html' %}</div>
            {% empty %}
            {% if project|can_answer:user %}{% trans "Discuss" %} {{object.title}}{% endif %}
            {% endfor %}
        </div>
        {% if project|can_answer:user %}
            <a class="clickable op_larger" onclick="addMessage(null, {{project.id}})">
                <div class="moreblue funding_msg_position" alt="{% trans "Add a discussion" %}" title="{% trans "Add a discussion" %}">+</div> {% trans "Add a discussion" %}
            </a>
        {% endif %}
    </div>
{% endwith %}

</div>

<div class="column">
    <div class="statebtns"> 
        {% if object.all_not_started_tasks %}<div onclick="featureShowHide('features_0')" id="featureid_proposed" class="clickable statebtn">{% trans "Proposed" %}</div>{% endif %}
        {% if object.all_progress_tasks %}<div onclick="featureShowHide('features_3')" id="featureid_progress" class="clickable statebtn">{% trans "In progress" %}</div>{% endif %}
        {% if object.all_finish_tasks %}<div onclick="featureShowHide('features_4')" id="featureid_finish" class="clickable statebtn">{% trans "Finished" %}</div>{% endif %}
        <div class="cleared"></div>
    </div>

    {% if not object.all_not_started_tasks %}<div class="features" id="features_0"><div id="nofeatures"></div></div>{% endif %}  
    {% if object.all_not_started_tasks %}
        <div class="features" id="features_0">
            {% for task in object.all_not_started_tasks %}
                <div class="cleared"></div>
                {% if task|can_read:user %}
                    {% include 'funding/feature.html' %}
                {% endif %}
            {% endfor %}
        </div>
        <div class="cleared"></div>
    {% endif %}

    {% if object.all_progress_tasks %}
        <div class="features" id="features_3">
            {% for task in object.all_progress_tasks %}
                <div class="cleared"></div>
                {% if task|can_read:user %}
                    {% include 'funding/feature.html' %}
                {% endif %}
            {% endfor %}
        </div>
        <div class="cleared"></div>
    {% endif %}

    {% if object.all_finish_tasks %}
        <div class="features" id="features_4">
            {% for task in object.all_finish_tasks %}
                <div class="cleared"></div>
                {% if task|can_read:user %}
                    {% include 'funding/feature.html' %}
                {% endif %}
            {% endfor %}
        </div>
        <div class="cleared"></div>
    {% endif %}


    <div class="featureblock">
        <div class="featuretitle" id="feature_{{object.id}}">{% trans "Propose a new feature" %}</div>
        <form style="margin:5px 0;width:220px" onsubmit="addTask(getValue('newtask_title_{{object.id}}', true), {{object.id}}, null,function(taskid){OIajaxCall('/funding/'+taskid+'/task', null, newDiv('features_0'))}); return false" id="newtask_{{object.id}}">
            <input type="image" title="New feature" alt="New feature" src="/img/icons/addtask.png">
            <label for="newtask_title_{{object.id}}" class="inputnewtask">{% trans "Feature name" %}</label>
            <input type="text" style="border:1px solid" class="newtask_title" id="newtask_title_{{object.id}}">
        </form>
    </div>
</div>

<script>
    currentTask = {{object.id}};
    if(!document.getElementById("nofeatures")){
        featureShowHide('features_0');
    }else if(document.getElementById("features_3")){
        featureShowHide('features_3');
    }else if(document.getElementById("features_4")){
        featureShowHide('features_4');
    }
</script>
{% else %}
{% trans "Forbidden" %}
{% endif %}
{% endblock %}
