{% extends "funding/base.html" %}
﻿﻿{% load oifilters %}
{% load i18n %}
{% block title %}{{object.title|default:_("Project")}}{% endblock %}
{% block breadcrumb %}
<div class="path-element">{{object.title}}</div>
{% endblock %}
{% block content %}
{% if object|can_read:user %}
<div class="prjbody">
    {% with object as project %}
    <div id="project_{{object.id}}" class="project">
        <div id="prjdialogue_{{object.id}}" class="popup invisible"></div>
        <div class="prjheader">
            <div class="prjauthor">{% trans "Project created by" %} <a href="/user/profile/{{object.author.username}}">{{object.author.get_profile}}</a></div>
            <div>
                <div class="tasktitle_funding" id="prjtitle_{{object.id}}" title="{{object.title}}">
                    {{object.title}}
                </div>
                <div class="prj-block-fav">
                    <img onclick="favProject(174)" src="/img/icons/starTrueFunding.png" alt="{% trans 'follow the project' %}" title="{% trans 'follow the project' %}" class="clickable followicon" id="fav_174">
                    {{object.observer_set.count}} {% blocktrans count counter=object.observer_set.count %} subscriber {% plural %} subscribers {% endblocktrans %}
                </div>
            </div>
            <div id="funding_all_spec" class="cleared">{% if object|can_write:user %}<a href="edit"><div class="bidaction_funding">{% trans "edit" %}</div></a>{% endif %}</div>
            <div id="specs_{{project.id}}" class="prjdesc">
                {%for spec in project.spec_set.all|dictsort:"order"%}
                <div style="position:relative" id="spec_{{project.id}}_{{spec.order}}" class="cleared">
                    {%include 'funding/spec/spec.html'%}
                </div>
                {% endfor %}
            </div>
            <div id="discussions_{{project.id}}" class="discussions">
                {% for message in project.message_set.all %}
                <div id="message_{{message.id}}_box">{% include 'messages/message.html' %}</div>
                {% empty %}
                {% if project|can_answer:user %}{% trans "Discuss" %} {{object.title}}{% endif %}
                {% endfor %}
            </div>
            {% if project|can_answer:user %}
            <a class="actions_funding clickable" onclick="addMessage(null, {{project.id}})">
                <div class="moreblue" alt="{% trans "Add a discussion" %}" title="{% trans "Add a discussion" %}">+</div> {% trans "Add a discussion" %}
            </a>
            {% endif %}
        </div>
        <div class="cleared"></div>
    </div>
    {% endwith %}
</div>
{% else %}
{% trans "Forbidden" %}
{% endif %}
{% endblock %}
{% block related %}
<div class="prjtitle">{{object.tasks.count}} {% trans "features" %}</div>
{% regroup object.tasks.all|dictsort:"state" by state as task_list %}
<div id="features">
{% for tasks in task_list %}
{{OI_PRJ_STATES|get:tasks.grouper}}
{% for task in tasks.list %}
{% include 'funding/feature.html' %}
{% endfor %}
{% endfor %}
</div>
{% if object|can_answer:user and user.is_authenticated %}
<div class="featureblock">
    <form id="newtask_{{object.id}}" onsubmit="addTask(getValue('newtask_title_{{object.id}}', true), {{object.id}}, function(taskid){OIajaxCall('/funding/'+taskid+'/task', null, newDiv('features'))}); return false" style="margin:5px 0;width:220px">
        <input type="image" src="/img/icons/addtask.png" alt="{% trans 'New task' %}" title="{% trans 'New task' %}" />
        <input type="text" id="newtask_title_{{object.id}}" class="newtask_title" style="border:1px solid" value="{% trans 'New task' %}" onclick="if(this.value=='{% trans 'New task' %}')this.value=''" onblur="if(!this.value)this.value='{% trans 'New task' %}'"/>
    </form>
</div>
{% endif %}
{% endblock %}
