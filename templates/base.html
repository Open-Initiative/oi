{% load i18n %}
{% load oifilters %}
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="shortcut icon" href="/favicons.ico" />
    <link rel="stylesheet" type="text/css" media="all" href="/css/jsDatePick_ltr.min.css" />
    <link rel="stylesheet" type="text/css" href="/css/oi.css" />
    <link rel="stylesheet" type="text/css" media="all" href="/css/oimessages.css" />
    <link rel="stylesheet" type="text/css" media="all" href="/css/oiprojects.css" />
    <link rel="stylesheet" type="text/css" media="all" href="/css/oiusers.css" />
    <script type="text/javascript" src="/js/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="/js/tiny_mce/tiny_mce.js"></script>
    <script type="text/javascript" src="{% url django.views.i18n.javascript_catalog %}"></script>
    <script type="text/javascript" src="/js/jsDatePick.min.1.3.js"></script>
    <script type="text/javascript" src="/js/dateFormat.js"></script>
    <script type="text/javascript" src="/js/oijs.js"></script>
    <script type="text/javascript" src="/js/oimessage.js"></script>
    <script type="text/javascript" src="/js/oiproject.js"></script>
    <script type="text/javascript" src="/js/oiuser.js"></script>
    <script type="text/javascript" src="/js/oitree.js"></script>
    <script type="text/javascript" src="/js/oitable.js"></script>
    <script type="text/javascript" src="/js/oigantt.js"></script>
    <title>{% block title %}{% endblock %} - Open Initiative</title>
</head>

<body>
    <div id="messageoutput">
        {% for message in messages %}
        <div><span class="{{ message.tags }}">{{ message }}</span></div>
        {% endfor %}
        <div><span id="output" class="info"></span></div>
    </div>
    <div id="topline">
        <div class="center">
            <div id="toptext">
                <form action="/i18n/setlang/" method="post">
                    {%if user.is_authenticated%}
                    <a class="toplink" href="/user/myprofile"><img src="/img/icons/miniuser.png" />{% trans "My profile" %}</a> |
                    <a class="toplink" href="/user/preferences"><img src="/img/icons/minisettings.png" />{% trans "Settings" %}</a> |
                    <a class="toplink" href="/logout"><img src="/img/icons/minilogout.png" />{% trans "Disconnect" %} {{user}}</a> |
                    {% endif %}
                    {% csrf_token %}
                    <input type="hidden" name="language" value="{% if LANGUAGE_CODE = "fr" %}en{% else %}fr{% endif %}">
                    <input type="image" src="/img/{% if LANGUAGE_CODE = "fr" %}en{% else %}fr{% endif %}.png" />
                </form>
            </div>
        </div>
    </div>
    <div id="header">
        <div class="center">
            {% block header %}
            <div style='width:0;float: left;font-family: "Interstate";font-size: 12px;font-weight: bold;left: 185px;padding: 1px;position: relative;top: 56px;'>BETA</div>
            <div id="logo"><a href="/"><img style="height:75px" src="/img/logo.png" /></a></div>
            <div id="searchdiv">
                <div id="baseline">{% trans "The IT community dedicated to your business" %}</div>
                <img src="/img/baseunderline.png" />
                <div class="sepsearch"></div>
                {% comment %}<div id="search"><form name="searchform" action="/search" method="GET">
                    <input class="searchbox" name="q" type="text" value="Rechercher..." onclick="value=''" />
                    <input id="searchbtn" type="image" src="/img/icons/search.png" />
                </form></div>{% endcomment %}
            </div>
                {%if user.is_authenticated%}<div style="float:left;margin-top:5px"><img class="contactpicture" src="/user/getpicture/{{user.username}}" /></div>{% endif %}
            <div id="userheader">
                {%if user.is_authenticated%}
                <div class="usertitle"><a href="/user/myprofile" style="color:#D0574C;">
                    {{user.get_profile}} <br />
                    <span class="nobold">{{user.get_profile.title}}</span>
                </a></div>
<!--                <div id="userlinks">-->
<!--                    <a class="homelink" href="/user/dashboard">{% trans "Dashboard" %}</a> |-->
<!--                    <a class="homelink" href="/notification">{% trans "Notices" %}</a> |-->
<!--                    <a class="homelink" href="/user/discussions">{% trans "Personal Messages" %}</a> <br/>-->
<!--                    <a class="toplink" href="/user/myblog">{% trans "Publications" %}</a> |-->
<!--                    <a class="toplink" href="/user/myaccount">{% trans "Transactions" %}</a>-->
<!--                </div>-->
                {%else%}
                <img src="/img/sep1.png" />
                <span id="loginbox">{% trans "Login" %}</span>
                <img src="/img/sep2.png" />
                <form method="post" action="{% url django.contrib.auth.views.login %}" style="margin:0">{% csrf_token %}
                    <div id="loginarea"><table>
                        <tr>
                            <td><label for="id_username">{% trans "username" %}</label></td>
                            <td><input id="id_username" type="text" name="username" tabindex=1 class="loginfield" /></td>
                            <td><input id="loginbtn" type="submit" tabindex=3 value="{% trans "login" %}" /></td>
                        </tr>
                        <tr>
                            <td><label for="id_password">{% trans "password" %}</label></td>
                            <td><input type="password" name="password" id="id_password" tabindex=2 class="loginfield" /></td>
                            <td><a href="/user/resetpassword" class="forgotpwd">{% trans "Forgot your password?" %}</a></td>
                        </tr>
                    </table></div>
                    <input type="hidden" name="next" value="{{request.get_full_path}}" />
                </form>
                {%endif%}
            </div>
            {% endblock %}
        </div>
    </div>
    {% block announcement %}
    {% endblock %}
    <div class="headersep">
        {% block headersep %}
        <div class="center">
        </div>
        {% endblock %}
    </div>
    <div class="center">
    
    <div class="topPage">
        {% if object %}
           <div class="prjBlockPrivate">
                <div >
                    {% if project.public %}{% trans "Public" %}{% else %}{% trans "Private" %}{% endif %} {% trans "task" %} 
                </div>
                    <a class="clickable" onclick="toggleHideProject({{object.id}})"> {% trans "Make this task" %} {% if project.public %}{% trans "private" %}{% else %}{% trans "public" %}{% endif %}<img src="/img/icons/bluebtn.png"/></a>
            </div>
            <div class="prjBlockFavP">
                <div class="prjStarFav">
                    <img id="fav_{{object.id}}" class="clickable" title="{% trans 'follow the project' %}" alt="{% trans 'follow the project' %}" src="/img/icons/star{{object|is_following:user}}.png" onclick="favProject({{object.id}})">
                </div>
                <div>
                {{object.observer_set.count}} {% blocktrans count counter=object.observer_set.count %} subscriber {% plural %} subscribers {% endblocktrans %}
                </div>
            </div>          
            {% for task in object.ancestors|filter_read:user %}
                <a href="/project/{{task.id}}/view/overview">{{task.title}}</a> &gt; 
            {% endfor %}
        {% endif %}
        <div id="pagetitle">{% block pagetitle %}{% endblock %}</div>
    </div>
       <script>
            follow = {% if object|is_following:user %}true{%else%}false{%endif%};
       </script>
        <div class="column">
            <div class="prjBlockAction"> 
                {% if object %}
                    <div class="prjActionDel">
                        {% if object|can_write:user and object.state < 2 and object.bid_set.count == 0 and object.tasks.count == 0 %}
                            <img src="/img/icons/del-32.png" class="clickable actions" alt="{% trans "Delete the task" %}" title="{% trans "Delete the task" %}" onclick="deleteProject({{object.id}})" />
                        {% endif %}
                        {% if object.state < 4 and object.bid_set.count > 0 and user == object.assignee %}
                            <img src="/img/icons/del-32.png" class="clickable actions" alt="{% trans "Cancel" %}" title="{% trans "Cancel" %}" onclick="cancelProject({{object.id}}, {{object.state}})" />
                        {% endif %}
                    </div>
                    {% if object.assignee == user %}
                        {% if object.state < 2 and object.is_ready_to_start %}
                            <div class="prjActionBtn clickable" onclick="startProject({{object.id}})">{% trans "Start" %} <img src="/img/icons/bluebtn.png" /></div>
                        {% endif %}
                        {% if object.state == 2 %}
                            <div class="prjActionBtn clickable" onclick="deliverProject({{object.id}})">{% trans "Deliver" %} <img src="/img/icons/bluebtn.png" /></div>
                        {% endif %}
                    {% endif %}
                    {% with object|bids:user as bids %}{% if bids %}
                        {% if object.state == 3 and not bids.0.validated %}
                            <div class="prjActionBtn clickable" onclick="validateProject({{object.id}})">{% trans "Validate" %} <img src="/img/icons/bluebtn.png" /></div>
                        {% endif %}
                        {% if object.state == 4 and object.assignee != user and bids.0.rating == None %}
                            <div class="prjActionBtn clickable" onclick="evalProject({{object.id}})">{% trans "Evaluate" %} <img src="/img/icons/bluebtn.png" /></div>
                        {% endif %}
                    {% endif %}{% endwith %}
                    {% if object.assignee == user %}
                        {% if object.state == 3 %}
                            <div class="prjActionWait">
                                {% with object|bids:user as bids %}
                                {% blocktrans count counter=bids|length %}Waiting for the bidder{% plural %}Waiting for the bidders{% endblocktrans %}
                                {% endwith %}
                            </div>
                        {% endif %}
                    {% endif %}
                    
                    {% ifequal object.state 2 %}
                            <div class="progressbar{% ifequal object.assignee user %} clickable" onclick="updateProgress({{object.id}},(event.clientX-this.offsetLeft)/this.offsetWidth){% endifequal %}">
                                <span id="progressbar_{{object.id}}" class="progress" style="width:{{object.progress|default:0|floatformat:0}}%;"></span>
                                <span id="progresslabel_{{object.id}}" class="progresstitle" >{{object.progress|default:0|floatformat:0}}%</span>
                            </div>
                    {% endifequal %}
                {% endif %}
            </div>
            
            <div id="nav">
                {% block nav %}{% endblock %}
            </div>
        </div>
        
        <div id="content">
            {% block content %}{% endblock %}
        </div>
        <div class="cleared"></div>
    </div>    
    <div id="footer">
        <a class="footlink" href="/cgu">{% trans "Terms of Use" %}</a> |
        <a class="footlink" href="{%trans "/presentation" %}">{% trans "Presentation" %}</a> |
        <a class="footlink" href="/contact">{% trans "Legal notice" %}</a> |
        <a class="footlink" href="/contact">{% trans "Contact" %}</a>
    </div>
</body>
</html>
